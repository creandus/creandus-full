# Copyright 2006 Mike Kelly
# Distributed under the terms of the GNU General Public License v2
#
# read_groupdata.sh - Read the proper data file for the desired group
# $Id$

# In the full implementation, should go through all the cascading
# profiles in proper order, but for now we're just parsing these 2
# config files

# XXX: Build groupfile dynamically based upon the currently selected 
# profile. Work from the profile up to its parents, etc, to build this 
# list.

# XXX: Split this file up in such a way as to be automatically done
# correctly for various distros.

# read_groupdata()
# Inputs:
#  $1 - name of group to be added
# Outputs:
#  $groupid - a range specification of valid group ids for the given group name
read_groupdata() {
	local groupfile="${DATADIR}/group/${1} ${DATADIR}/accounts"
	local groupid_ groupid

	for x in ${groupfile}; do
		groupid_=$(grep ^gid: ${x} |cut -d: -f2)
		groupid_=`echo ${groupid_} |sed 's,^[[:space:]]*,,'`
		groupid=${groupid:-${groupid_}}
	done

	[[ -z "${groupid}" ]] && die "couldn't determine a gid range"

	echo "local groupid=\"${groupid}\""
}
# vim: ts=4 :
