#!/bin/bash
#
# This script is called when an install fails. It rolls back the changes made
# by the add.bash script.
#
# $Id$

prefix=@prefix@
datarootdir=@datarootdir@
scriptdir=@datadir@/@PACKAGE@

# Load the basic configuration
. "${scriptdir}/common/config.bash"

# Read the command line arguments.
# Currently, we expect the following:
ENEWUSERS=${1}
ENEWGROUPS=${2}
PKGNAME=${3}
USERSPACE=${4}
ROOT=${5:-/}

if [[ -z "${PKGNAME}" || -z "${USERSPACE}" ]] ; then
	echo "Script expects 4 arguments:" >&2
	echo "  \"new users list\" \"new groups list\" pkgname userspace" >&2
	exit 1
fi

# Remove this instance of PKGNAME from the database
"${scriptdir}/db.bash" del "${PKGNAME}" "${ROOT}"

# If this install process created any users, then we should now remove them.
for x in ${ENEWUSERS} ; do
	"${scriptdir}/deluser.bash" "${x}" "${PKGNAME}" "${USERSPACE}" "${ROOT}"
done

for x in ${ENEWGROUPS} ; do
	"${scriptdir}/delgroup.bash" "${x}" "${PKGNAME}" "${USERSPACE}" "${ROOT}"
done
